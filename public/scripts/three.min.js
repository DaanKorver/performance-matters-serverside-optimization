import{getAllBooks}from"./modules/api.min.js";const scene=new THREE.Scene,camera=(scene.background=new THREE.Color(16777215),new THREE.PerspectiveCamera(140,window.innerWidth/window.innerHeight,.1,1e3)),renderer=new THREE.WebGLRenderer({alpha:!0}),controls=(renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(0,0),document.body.appendChild(renderer.domElement),new THREE.OrbitControls(camera,renderer.domElement)),loader=(controls.enableRotate=!1,controls.enableZoom=!1,controls.enableDamping=!0,controls.mouseButtons={LEFT:THREE.MOUSE.PAN},controls.touches={ONE:THREE.TOUCH.PAN},controls.panSpeed=.4,controls.dampingFactor=.03,new THREE.TextureLoader),raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,group=new THREE.Group,light=(setGroup(),new THREE.PointLight(16777215,1,0));function animate(){requestAnimationFrame(animate),controls.update(),renderer.render(scene,camera)}async function setGroup(){var o=await getAllBooks();for(let e=0;e<o.length;e++){var n=new THREE.MeshBasicMaterial({map:loader.load("https://raw.githubusercontent.com/JustinLung/the-web-is-for-everyone-scrollbook/"+o[e].book_cover),transparent:!0}),t=new THREE.PlaneGeometry(7.04,9);const a=new THREE.Mesh(t,n);a.callback=function(){gsap.to(group.children[e].material,{opacity:0}),gsap.to(group.children[e].position,{z:2}),setTimeout(()=>{window.location.href="/book/"+(e+1)},1100)};var t=[3,4],[n,r]=getBookPositionCool(e,t),i=[0,.5];a.position.x=9*n,a.position.y=11*r-11*i[n%t.length],group.add(a)}(new THREE.Box3).setFromObject(group).getCenter(group.position).multiplyScalar(-1),scene.add(group);for(let e=0;e<group.children.length;e++)gsap.fromTo(group.children[e].material,{opacity:0},{opacity:1,delay:.1*e}),gsap.fromTo(group.children[e].position,{z:1.5},{z:1,delay:.1*e})}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),animate()}function onMouseClick(e){e.preventDefault(),mouse.x=e.clientX/renderer.domElement.clientWidth*2-1,mouse.y=2*-(e.clientY/renderer.domElement.clientHeight)+1,raycaster.setFromCamera(mouse,camera);const o=raycaster.intersectObjects(group.children);0<o.length&&o[0].object.callback()}function getBookPosition(e){var o=e%7,n=o<3;let t=2*Math.floor(e/7),r=(n||t++,o);return n||(r-=3),[t,r]}function getBookPositionCool(e,o){var n=o.reduce((e,o)=>e+o),t=Math.floor(e/n),r=e%n;let i=0,a=0;for(let e=0;e<o.length;e++){var c=o[e];if((i+=c)>r)break;a++}e=t*o.length+a;const s=o.slice(0,a);return[e,r-(0<s.length?s.reduce((e,o)=>e+o):0)]}light.position.set(1,1,100),scene.add(light),camera.position.z=5,camera.minDistance=5,controls.update(),window.addEventListener("load",onWindowResize),window.addEventListener("resize",onWindowResize),renderer.domElement.addEventListener("click",onMouseClick),animate();